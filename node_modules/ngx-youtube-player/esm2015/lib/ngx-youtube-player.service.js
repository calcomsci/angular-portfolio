import { Injectable, NgZone } from "@angular/core";
import { ReplaySubject } from "rxjs";
import * as i0 from "@angular/core";
export function win() {
    return window;
}
export function YouTubeRef() {
    return win()["YT"];
}
export function YouTubePlayerRef() {
    return YouTubeRef().Player;
}
export const defaultSizes = {
    height: 270,
    width: 367,
};
export class YoutubePlayerService {
    constructor(zone) {
        this.zone = zone;
        this.api = new ReplaySubject(1);
        this.createApi();
    }
    loadPlayerApi(options) {
        const doc = win().document;
        if (!YoutubePlayerService["ytApiLoaded"]) {
            YoutubePlayerService.ytApiLoaded = true;
            const playerApiScript = doc.createElement("script");
            playerApiScript.type = "text/javascript";
            playerApiScript.src = `${options.protocol}://www.youtube.com/iframe_api`;
            doc.body.appendChild(playerApiScript);
        }
    }
    setupPlayer(elementId, outputs, sizes, videoId = "", playerVars) {
        const createPlayer = () => {
            if (YouTubePlayerRef) {
                this.createPlayer(elementId, outputs, sizes, videoId, playerVars);
            }
        };
        this.api.subscribe(createPlayer);
    }
    play(player) {
        player.playVideo();
    }
    pause(player) {
        player.pauseVideo();
    }
    playVideo(media, player) {
        const id = media.id.videoId ? media.id.videoId : media.id;
        player.loadVideoById(id);
        this.play(player);
    }
    isPlaying(player) {
        // because YT is not loaded yet 1 is used - YT.PlayerState.PLAYING
        const isPlayerReady = player && player.getPlayerState;
        const playerState = isPlayerReady ? player.getPlayerState() : {};
        const isPlayerPlaying = isPlayerReady
            ? playerState !== YouTubeRef().PlayerState.ENDED &&
                playerState !== YouTubeRef().PlayerState.PAUSED
            : false;
        return isPlayerPlaying;
    }
    createPlayer(elementId, outputs, sizes, videoId = "", playerVars = {}) {
        const playerSize = {
            height: sizes.height || defaultSizes.height,
            width: sizes.width || defaultSizes.width,
        };
        const ytPlayer = YouTubePlayerRef();
        return new ytPlayer(elementId, Object.assign(Object.assign({}, playerSize), { events: {
                onReady: (ev) => {
                    this.zone.run(() => outputs.ready && outputs.ready.next(ev.target));
                },
                onStateChange: (ev) => {
                    this.zone.run(() => outputs.change && outputs.change.next(ev));
                },
            }, playerVars,
            videoId }));
    }
    toggleFullScreen(player, isFullScreen) {
        let { height, width } = defaultSizes;
        if (!isFullScreen) {
            height = window.innerHeight;
            width = window.innerWidth;
        }
        player.setSize(width, height);
    }
    // adpoted from uid
    generateUniqueId() {
        const len = 7;
        return Math.random().toString(35).substr(2, len);
    }
    createApi() {
        const onYouTubeIframeAPIReady = () => {
            if (win()) {
                win()["onYouTubeIframeAPIReadyCalled"] = true;
                this.api.next();
            }
        };
        win()["onYouTubeIframeAPIReady"] = onYouTubeIframeAPIReady;
        /**
         * If onYouTubeIframeAPIReady is called in other place, then just trigger next
         * This is to prevent player not initializing issue when another player got initialized in other place
         */
        if (win()["onYouTubeIframeAPIReadyCalled"]) {
            this.api.next();
        }
    }
}
YoutubePlayerService.ytApiLoaded = false;
YoutubePlayerService.ɵprov = i0.ɵɵdefineInjectable({ factory: function YoutubePlayerService_Factory() { return new YoutubePlayerService(i0.ɵɵinject(i0.NgZone)); }, token: YoutubePlayerService, providedIn: "root" });
YoutubePlayerService.decorators = [
    { type: Injectable, args: [{
                providedIn: "root",
            },] }
];
YoutubePlayerService.ctorParameters = () => [
    { type: NgZone }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXlvdXR1YmUtcGxheWVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gteW91dHViZS1wbGF5ZXIvc3JjL2xpYi9uZ3gteW91dHViZS1wbGF5ZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDOztBQUdyQyxNQUFNLFVBQVUsR0FBRztJQUNqQixPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBRUQsTUFBTSxVQUFVLFVBQVU7SUFDeEIsT0FBTyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQVEsQ0FBQztBQUM1QixDQUFDO0FBRUQsTUFBTSxVQUFVLGdCQUFnQjtJQUM5QixPQUFPLFVBQVUsRUFBRSxDQUFDLE1BQWEsQ0FBQztBQUNwQyxDQUFDO0FBRUQsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHO0lBQzFCLE1BQU0sRUFBRSxHQUFHO0lBQ1gsS0FBSyxFQUFFLEdBQUc7Q0FDWCxDQUFDO0FBS0YsTUFBTSxPQUFPLG9CQUFvQjtJQUsvQixZQUFvQixJQUFZO1FBQVosU0FBSSxHQUFKLElBQUksQ0FBUTtRQUM5QixJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRUQsYUFBYSxDQUFDLE9BQWdDO1FBQzVDLE1BQU0sR0FBRyxHQUFHLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQztRQUMzQixJQUFJLENBQUMsb0JBQW9CLENBQUMsYUFBYSxDQUFDLEVBQUU7WUFDeEMsb0JBQW9CLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztZQUN4QyxNQUFNLGVBQWUsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFD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QVUsU0FBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7O1lBdkJvQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTmdab25lIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IFJlcGxheVN1YmplY3QgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgSVBsYXllckFwaVNjcmlwdE9wdGlvbnMsIElQbGF5ZXJPdXRwdXRzLCBJUGxheWVyU2l6ZSB9IGZyb20gXCIuL21vZGVsc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gd2luKCkge1xuICByZXR1cm4gd2luZG93O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gWW91VHViZVJlZigpOiBhbnkge1xuICByZXR1cm4gd2luKClbXCJZVFwiXSBhcyBhbnk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBZb3VUdWJlUGxheWVyUmVmKCkge1xuICByZXR1cm4gWW91VHViZVJlZigpLlBsYXllciBhcyBhbnk7XG59XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0U2l6ZXMgPSB7XG4gIGhlaWdodDogMjcwLFxuICB3aWR0aDogMzY3LFxufTtcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiBcInJvb3RcIixcbn0pXG5leHBvcnQgY2xhc3MgWW91dHViZVBsYXllclNlcnZpY2Uge1xuICBhcGk6IFJlcGxheVN1YmplY3Q8WVQuUGxheWVyPjtcblxuICBzdGF0aWMgeXRBcGlMb2FkZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHpvbmU6IE5nWm9uZSkge1xuICAgIHRoaXMuYXBpID0gbmV3IFJlcGxheVN1YmplY3QoMSk7XG4gICAgdGhpcy5jcmVhdGVBcGkoKTtcbiAgfVxuXG4gIGxvYWRQbGF5ZXJBcGkob3B0aW9uczogSVBsYXllckFwaVNjcmlwdE9wdGlvbnMpIHtcbiAgICBjb25zdCBkb2MgPSB3aW4oKS5kb2N1bWVudDtcbiAgICBpZiAoIVlvdXR1YmVQbGF5ZXJTZXJ2aWNlW1wieXRBcGlMb2FkZWRcIl0pIHtcbiAgICAgIFlvdXR1YmVQbGF5ZXJTZXJ2aWNlLnl0QXBpTG9hZGVkID0gdHJ1ZTtcbiAgICAgIGNvbnN0IHBsYXllckFwaVNjcmlwdCA9IGRvYy5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgcGxheWVyQXBpU2NyaXB0LnR5cGUgPSBcInRleHQvamF2YXNjcmlwdFwiO1xuICAgICAgcGxheWVyQXBpU2NyaXB0LnNyYyA9IGAke29wdGlvbnMucHJvdG9jb2x9Oi8vd3d3LnlvdXR1YmUuY29tL2lmcmFtZV9hcGlgO1xuICAgICAgZG9jLmJvZHkuYXBwZW5kQ2hpbGQocGxheWVyQXBpU2NyaXB0KTtcbiAgICB9XG4gIH1cblxuICBzZXR1cFBsYXllcihcbiAgICBlbGVtZW50SWQ6IHN0cmluZyxcbiAgICBvdXRwdXRzOiBJUGxheWVyT3V0cHV0cyxcbiAgICBzaXplczogSVBsYXllclNpemUsXG4gICAgdmlkZW9JZCA9IFwiXCIsXG4gICAgcGxheWVyVmFyczogWVQuUGxheWVyVmFyc1xuICApIHtcbiAgICBjb25zdCBjcmVhdGVQbGF5ZXIgPSAoKSA9PiB7XG4gICAgICBpZiAoWW91VHViZVBsYXllclJlZikge1xuICAgICAgICB0aGlzLmNyZWF0ZVBsYXllcihlbGVtZW50SWQsIG91dHB1dHMsIHNpemVzLCB2aWRlb0lkLCBwbGF5ZXJWYXJzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHRoaXMuYXBpLnN1YnNjcmliZShjcmVhdGVQbGF5ZXIpO1xuICB9XG5cbiAgcGxheShwbGF5ZXI6IFlULlBsYXllcikge1xuICAgIHBsYXllci5wbGF5VmlkZW8oKTtcbiAgfVxuXG4gIHBhdXNlKHBsYXllcjogWVQuUGxheWVyKSB7XG4gICAgcGxheWVyLnBhdXNlVmlkZW8oKTtcbiAgfVxuXG4gIHBsYXlWaWRlbyhtZWRpYTogYW55LCBwbGF5ZXI6IFlULlBsYXllcikge1xuICAgIGNvbnN0IGlkID0gbWVkaWEuaWQudmlkZW9JZCA/IG1lZGlhLmlkLnZpZGVvSWQgOiBtZWRpYS5pZDtcbiAgICBwbGF5ZXIubG9hZFZpZGVvQnlJZChpZCk7XG4gICAgdGhpcy5wbGF5KHBsYXllcik7XG4gIH1cblxuICBpc1BsYXlpbmcocGxheWVyOiBZVC5QbGF5ZXIpIHtcbiAgICAvLyBiZWNhdXNlIFlUIGlzIG5vdCBsb2FkZWQgeWV0IDEgaXMgdXNlZCAtIFlULlBsYXllclN0YXRlLlBMQVlJTkdcbiAgICBjb25zdCBpc1BsYXllclJlYWR5OiBhbnkgPSBwbGF5ZXIgJiYgcGxheWVyLmdldFBsYXllclN0YXRlO1xuICAgIGNvbnN0IHBsYXllclN0YXRlID0gaXNQbGF5ZXJSZWFkeSA/IHBsYXllci5nZXRQbGF5ZXJTdGF0ZSgpIDoge307XG4gICAgY29uc3QgaXNQbGF5ZXJQbGF5aW5nID0gaXNQbGF5ZXJSZWFkeVxuICAgICAgPyBwbGF5ZXJTdGF0ZSAhPT0gWW91VHViZVJlZigpLlBsYXllclN0YXRlLkVOREVEICYmXG4gICAgICAgIHBsYXllclN0YXRlICE9PSBZb3VUdWJlUmVmKCkuUGxheWVyU3RhdGUuUEFVU0VEXG4gICAgICA6IGZhbHNlO1xuICAgIHJldHVybiBpc1BsYXllclBsYXlpbmc7XG4gIH1cblxuICBjcmVhdGVQbGF5ZXIoXG4gICAgZWxlbWVudElkOiBzdHJpbmcsXG4gICAgb3V0cHV0czogSVBsYXllck91dHB1dHMsXG4gICAgc2l6ZXM6IElQbGF5ZXJTaXplLFxuICAgIHZpZGVvSWQgPSBcIlwiLFxuICAgIHBsYXllclZhcnM6IFlULlBsYXllclZhcnMgPSB7fVxuICApIHtcbiAgICBjb25zdCBwbGF5ZXJTaXplID0ge1xuICAgICAgaGVpZ2h0OiBzaXplcy5oZWlnaHQgfHwgZGVmYXVsdFNpemVzLmhlaWdodCxcbiAgICAgIHdpZHRoOiBzaXplcy53aWR0aCB8fCBkZWZhdWx0U2l6ZXMud2lkdGgsXG4gICAgfTtcbiAgICBjb25zdCB5dFBsYXllciA9IFlvdVR1YmVQbGF5ZXJSZWYoKTtcbiAgICByZXR1cm4gbmV3IHl0UGxheWVyKGVsZW1lbnRJZCwge1xuICAgICAgLi4ucGxheWVyU2l6ZSxcbiAgICAgIGV2ZW50czoge1xuICAgICAgICBvblJlYWR5OiAoZXY6IFlULlBsYXllckV2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiBvdXRwdXRzLnJlYWR5ICYmIG91dHB1dHMucmVhZHkubmV4dChldi50YXJnZXQpKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25TdGF0ZUNoYW5nZTogKGV2OiBZVC5QbGF5ZXJFdmVudCkgPT4ge1xuICAgICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4gb3V0cHV0cy5jaGFuZ2UgJiYgb3V0cHV0cy5jaGFuZ2UubmV4dChldikpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHBsYXllclZhcnMsXG4gICAgICB2aWRlb0lkLFxuICAgIH0pO1xuICB9XG5cbiAgdG9nZ2xlRnVsbFNjcmVlbihcbiAgICBwbGF5ZXI6IFlULlBsYXllcixcbiAgICBpc0Z1bGxTY3JlZW46IGJvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkXG4gICkge1xuICAgIGxldCB7IGhlaWdodCwgd2lkdGggfSA9IGRlZmF1bHRTaXplcztcblxuICAgIGlmICghaXNGdWxsU2NyZWVuKSB7XG4gICAgICBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgICB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIH1cbiAgICBwbGF5ZXIuc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgfVxuXG4gIC8vIGFkcG90ZWQgZnJvbSB1aWRcbiAgZ2VuZXJhdGVVbmlxdWVJZCgpOiBzdHJpbmcge1xuICAgIGNvbnN0IGxlbiA9IDc7XG4gICAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzUpLnN1YnN0cigyLCBsZW4pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcGkoKSB7XG4gICAgY29uc3Qgb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHkgPSAoKSA9PiB7XG4gICAgICBpZiAod2luKCkpIHtcbiAgICAgICAgd2luKClbXCJvbllvdVR1YmVJZnJhbWVBUElSZWFkeUNhbGxlZFwiXSA9IHRydWU7XG4gICAgICAgIHRoaXMuYXBpLm5leHQoKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHdpbigpW1wib25Zb3VUdWJlSWZyYW1lQVBJUmVhZHlcIl0gPSBvbllvdVR1YmVJZnJhbWVBUElSZWFkeTtcbiAgICAvKipcbiAgICAgKiBJZiBvbllvdVR1YmVJZnJhbWVBUElSZWFkeSBpcyBjYWxsZWQgaW4gb3RoZXIgcGxhY2UsIHRoZW4ganVzdCB0cmlnZ2VyIG5leHRcbiAgICAgKiBUaGlzIGlzIHRvIHByZXZlbnQgcGxheWVyIG5vdCBpbml0aWFsaXppbmcgaXNzdWUgd2hlbiBhbm90aGVyIHBsYXllciBnb3QgaW5pdGlhbGl6ZWQgaW4gb3RoZXIgcGxhY2VcbiAgICAgKi9cbiAgICBpZiAod2luKClbXCJvbllvdVR1YmVJZnJhbWVBUElSZWFkeUNhbGxlZFwiXSkge1xuICAgICAgdGhpcy5hcGkubmV4dCgpO1xuICAgIH1cbiAgfVxufVxuIl19